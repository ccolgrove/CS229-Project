<?xml version="1.0"?><api><query><pages><page pageid="16094885" ns="0" title="VHD (file format)"><revisions><rev xml:space="preserve">{{Use dmy dates|date=December 2010}}
{{Redirect|Virtual Hard Disk||Virtual drive}}
{{Redirect|.vhd|hardware description language file|VHDL}}
{{refimprove|date=March 2010}}
{{More footnotes|date=March 2010}}

{{Infobox file format
| name = Virtual Hard Disk
| icon = [[File:VHD File.png]]
| logo =
| extension = .vhd
| mime =
| type code =
| uniform type =
| magic =
| owner = [[Connectix]] / [[Microsoft]]
| genre = [[Disk image]]
| container for = [[Virtual machine]] [[disk image]]s
| contained by =
| extended from =
| extended to =
| standard =
}}
A '''Virtual Hard Disk''' (VHD) is a virtual hard disk [[file format]], meaning it can contain what is found on a physical [[hard disk drive]], such as [[Disk partitioning|disk partitions]] and a [[file system]], which in turn can contain [[Computer file|files]] and [[Folder (computing)|folders]]. It is typically used as the hard disk of a [[virtual machine]]. The format was created by [[Connectix]], which was later acquired by [[Microsoft]], for what is now known as ''[[Microsoft Virtual PC]]''. Since June 2005, Microsoft has made the VHD Image Format Specification available to third parties under the [[Microsoft Open Specification Promise]].&lt;ref name=&quot;spec&quot;&gt;{{cite web
 | url = http://technet.microsoft.com/en-us/library/bb676673.aspx
 | title = Virtual Hard Disk Image Format Specification
 | work = [[Microsoft TechNet]]
 | publisher = Microsoft Corporation
 | date = 27 February 2009
}}&lt;/ref&gt;

==Features==
A Virtual Hard Disk allows multiple operating systems to reside on a single host machine. This method enables developers to test software on different operating systems without the cost or hassle of installing a second hard disk or creating a separate [[Disk partitioning|partition]] on a single hard disk. The ability to directly modify a [[virtual machine]]âs hard disk from a host server supports many applications, including:
* Moving files between a VHD and the host file system
* Backup and recovery
* Antivirus and security
* Image management and patching
* Disk conversion (physical to virtual, and so on)
* Life-cycle management and provisioning

===Supported formats===
VHDs are implemented as files that reside on the native host file system. The following types of VHD formats are supported by Microsoft Virtual PC and Virtual Server:
* Fixed hard disk image - a file that is allocated to the size of the virtual disk. Fixed VHDs consist of a raw [[disk image]] followed by a VHD footer (512 or formerly 511 bytes).&lt;ref name=&quot;spec&quot; /&gt;
* Dynamic hard disk image - a file that at any given time is as large as the actual data written to it, plus the size of the header and footer. Dynamic and differencing VHDs begin with a copy of the VHD footer (padded to 512 bytes), and for dynamic or differencing VHDs created by Microsoft products this results in a VHD-cookie string ''&lt;abbr title='&quot;connectix&quot; trimmed to eight characters'&gt;conectix&lt;/abbr&gt;'' at the begin of the VHD file.&lt;ref name=&quot;spec&quot; /&gt;
* Differencing hard disk image - a set of modified blocks (maintained in a separate file referred to as the &quot;child image&quot;) in comparison to a parent image. The Differencing hard disk image format allows the concept of '''Undo Changes'''&amp;mdash;when enabled, all changes to a hard drive contained within a VHD (the parent image) are stored in a separate file (the child image).  Options are available to undo the changes to the VHD, or to merge them permanently into the VHD. Different child images based on the same parent image also allow &quot;cloning&quot; of VHDs; at least the [[globally unique identifier]] (GUID) must be different. 
* Linked to a hard disk - a file which contains a link to a physical hard drive or partition of a physical hard drive.{{Citation needed|date=July 2011}}

===Advantages===
Significant benefits result from the ability to boot a physical computer from a virtual hard drive:
* Ease of deployment:  IT organizations can deploy standardized, 'pre-built' configurations on a single VHD.  As an example, software engineering organizations which need a specific set of tools for a particular project could simply 'pull' the appropriately-configured VHD from a network location.
* Backup-and-Restore:  Changes to the contents of a VHD (such as infection by a virus, or accidental deletion of critical files) are easily undone.
* Multi-User Isolation:  Many current operating systems support having multiple users, but offer varying degrees of protection between them (e.g., one user of the OS could become infected by a virus which infects other users, or make changes to the OS which affect other users).  By giving each user their own version of the operating system -- say, by creating for each of them a differencing VHD based on a base installation of the OS -- changes to any particular child image would have no effect on any of the other child images. However, a virus can be programmed to search for VHDs and infect it - it's more a matter of securing file permissions and using the appropriate accounts (restricted user always, administrator or super user only when installing software or configuring the operating system).

===Native VHD Boot=== &lt;!-- Proper name; do not de-capitalize --&gt;
'''Native VHD Boot''' refers to the ability of a physical computer to [[mount (computing)|mount]] and boot from an operating system contained within a VHD.  [[Windows 7]] Enterprise and Ultimate editions support this ability, both with and without a host operating system present.  [[Windows Server 2008 R2]] is also compatible with this feature.&lt;ref&gt;{{Cite web
  |url=http://technet.microsoft.com/en-us/library/dd440865(WS.10).aspx
  |title=Frequently Asked Questions: Virtual Hard Disks in Windows 7 and Windows Server 2008 R2
  |accessdate = 12 November 2010
  |publisher = Microsoft corporation
  |work = Microsoft TechNet
  |date = 15 October 2010
}}&lt;/ref&gt;&lt;ref&gt;{{Cite web
  |url = http://technet.microsoft.com/en-us/library/dd744338(WS.10).aspx
  |title = Walkthrough: Deploy a Virtual Hard Disk for Native Boot
  |work = Microsoft TechNet
  |publisher = Microsoft corporation
  |date = 8 July 2010
  |accessdate = 12 November 2010
}}&lt;/ref&gt;
{{see|Windows Vista startup process}}

===Limitations===
The VHD format has a built-in limitation of 2 [[Terabytes|TB]] for the size of any dynamic or differencing VHDs.&lt;ref name=&quot;twoterabyte&quot;&gt;{{Cite web
 |url=http://technet.microsoft.com/nl-nl/library/ee405267(WS.10).aspx
 |title=Requirements and Limits for Virtual Machines and Hyper-V in Windows Server 2008 R2
 |accessdate=12 April 2010
 |publisher=Microsoft Corporation
 |year=2009
 |work=Microsoft TechNet
}}&lt;/ref&gt;&lt;ref name=&quot;vhdstorage&quot;&gt;{{Cite web
 |url=http://msdn.microsoft.com/en-us/library/dd323654(VS.85).aspx
 |title=About VHD
 |accessdate=12 April 2010
 |publisher=Microsoft Corporation
 |year=2009
 |work=[[MSDN]]
}}&lt;/ref&gt;&lt;ref name=&quot;vhdexplained&quot;&gt;{{Cite web
  |url = http://blogs.technet.com/ranjanajain/archive/2010/03/23/virtual-hard-disk-vhd-architecture-explained.aspx
  |title = Virtual Hard Disk (VHD) Architecture Explained
  |accessdate = 13 April 2010
  |publisher = Microsoft Corporation
  |year = 2009
  |first1 = Ranjana
  |last1 = Jain
  |work = Microsoft TechNet Blogs
  |date = 23 March 2010
}}&lt;/ref&gt; This is due to a sector offset table that only allows for the maximum of a 32-bit quantity.  It is calculated by multiplying &lt;math&gt;2^{32}&lt;/math&gt; by 512 bytes for each sector.

The &lt;code&gt;&lt;abbr title=&quot;cylinders&quot;&gt;C&lt;/abbr&gt;&amp;times;&lt;abbr title=&quot;heads&quot;&gt;H&lt;/abbr&gt;&amp;times;&lt;abbr title=&quot;sectors per track&quot;&gt;S&lt;/abbr&gt;&lt;/code&gt; formula in the VHD specification allows a maximum of &lt;tt&gt;65535&amp;times;16&amp;times;255&lt;/tt&gt; sectors.&lt;ref name=&quot;spec&quot; /&gt; About 127 &lt;abbr title=&quot;GigaBytes (here 1024*1024 KiloBytes)&quot;&gt;GB&lt;/abbr&gt; is also the limit for VHDs in [[Windows Virtual PC]].&lt;ref&gt;{{cite web
|url=http://technet.microsoft.com/en-us/sysinternals/ee656415
|title=Disk2vhd v1.63
|publisher=[[Microsoft]] [[Winternals|SysInternals]]
|year=2010
|accessdate=2011-07-14}}&lt;/ref&gt; For less than &lt;tt&gt;65535&amp;times;16&amp;times;63&lt;/tt&gt; sectors (about 31 GB) the CHS-value in the VHD footer uses a minimum of &lt;tt&gt;H=4&lt;/tt&gt; and a maximum of &lt;tt&gt;H=16&lt;/tt&gt; heads with &lt;tt&gt;S=17&lt;/tt&gt;, &lt;tt&gt;31&lt;/tt&gt;, or &lt;tt&gt;63&lt;/tt&gt; sectors per track. The CHS algorithm then determines &lt;code&gt;&lt;abbr title=&quot;cylinders&quot;&gt;C&lt;/abbr&gt;=(&lt;abbr title=&quot;total sectors&quot;&gt;T&lt;/abbr&gt;/&lt;abbr title=&quot;sectors per track&quot;&gt;S&lt;/abbr&gt;)/&lt;abbr title=&quot;heads&quot;&gt;H&lt;/abbr&gt;&lt;/code&gt;.&lt;ref name=&quot;spec&quot; /&gt; The specification does not discuss cases, where the CHS value in the VHD footer does not match the (virtual) CHS geometry in the [[Master Boot Record]] of the disk image in the VHD.

==Software using the VHD file format==
Virtual Hard Disk format was initially used only by [[Microsoft Virtual PC]]. Later however, Microsoft used the VHD format in [[Hyper-V]], the [[hypervisor]]-based virtualization technology of [[Windows Server 2008]]. Microsoft also used the format in [[Backup and Restore Center#Complete PC Backup|Complete PC Backup]], a [[backup software|backup software component]] included with [[Windows Vista]] and [[Windows 7]]. In addition, Windows 7 and [[Windows Server 2008|Windows Server 2008 R2]] include support for creating, mounting, and booting from VHD files.&lt;ref&gt;{{Cite web
  |url = http://blogs.msdn.com/chkoenig/archive/2008/10/28/pdc-day-2-windows-7-windows-live-mesh-and-office-online.aspx
  |title = PDC Day 2 â Windows 7, Windows Live, Mesh and Office Online
  |work = MSDN Blogs
  |publisher = Microsoft Corporation
  |first1 = Chris
  |last1 = Koenig
  |date = 28 October 2008
  |accessdate = 17 December 2010
}}&lt;/ref&gt;&lt;ref&gt;{{Cite web
  |url = http://www.3dhomejoe.info/jsite/uploads/vhd.pdf
  |title = How to make a Virtual Hard Drive in Windows 7
  |publisher = 3dhomejoe
  |accessdate = 22 January 2011
}}&lt;/ref&gt; 

The Vista (or later) ''drive manager'' &lt;abbr title=&quot;Graphical User Interface&quot;&gt;GUI&lt;/abbr&gt; supports a subset of the functions in the ''diskpart'' command line tool.&lt;ref&gt;{{cite web
|url=http://technet.microsoft.com/en-us/library/cc770877(v=ws.10).aspx
|title=DiskPart
|date=2010-10-25
|publisher=[[Microsoft]] Technet
|work=Windows Server 2008 and Windows Server 2008 R2
|accessdate=2011-07-15}}&lt;/ref&gt; VHDs known as ''vdisk'' in ''diskpart'' can be created, formatted, attached (mounted), detached (unmounted), merged (for differencing VHDs), and compacted (for VHDs on an NTFS host file system). Compacting is typically a two step procedure, first unused sectors in the VHD are filled with zeros, and then ''diskpart'' can use the [[NTFS]] feature of [[NTFS#Sparse_files|sparse files]] to eliminate runs of zeros in the VHD. The ''virtual machine additions'' in older [[Windows Virtual PC|VPC]] versions and the ''virtual machine integration features'' in [[Windows Virtual PC]] contain ''precompact'' [[ISO]] images for the first step in supported guest systems.&lt;ref&gt;{{cite web
|url=http://technet.microsoft.com/en-us/library/ee449414(v=ws.10).aspx
|title=Modify a virtual hard disk
|date=2009-06-25
|publisher=[[Microsoft]] Technet
|work=Windows 7 Technical Library
|accessdate=2011-07-15}}&lt;/ref&gt; 

Third-party products also use VHD file format. [[VirtualBox]], part of [[Sun xVM]] line of [[Sun Microsystems]] supports VHD in versions 2 and later.
[[VMware ESX Server]] and [[VMware Workstation]] also support the VHD file format as an alternative to its proprietary [[VMDK]] format. The VHD file format is also adopted by [[Xen|XenSource]] for what is now the [[Citrix Systems|Citrix]] [[Xen|XenServer]] hypervisor.

===Offline modification===
It is sometimes useful to modify a VHD file without booting an operating system.  [[Hyper-V]] features offline VHD manipulation â providing administrators with the ability to securely access files within a VHD without having to instantiate a virtual machine. This provides administrators with granular access to VHDs and the ability to perform some management tasks offline.&lt;ref&gt;{{cite web
 | url = http://technet.microsoft.com/en-us/windowsserver/2008/bb414776.aspx
 | title = Windows Server 2008 Reviewers Guide
 | publisher = Microsoft
 | date = 4 February 2008
}}&lt;/ref&gt;
The Windows Disk Management MMC plugin can directly attach a .vhd as a drive letter in Windows 7, Windows Server 2008 and Windows Server 2008 R2.  

For situations where mounting a VHD within the operating system is undesirable, several programs enable software developers to inspect and modify VHD files, including [[.NET DiscUtils]], [[WinImage]] and [[R1soft Hyper-V VHD Explorer]].

== Virtual Floppy Disk (VFD) ==
A '''Virtual Floppy Disk''' (VFD) is a related file format used by [[Windows Virtual PC]], Microsoft Automated Deployment services and Microsoft Virtual Server 2005.&lt;ref&gt;{{cite web|title=How to create a floppy disk image in Virtual PC for Windows versions 4.0 to 5.2|url=http://support.microsoft.com/kb/825098|work=Microsoft Support|publisher=Microsoft Corporation|accessdate=26 June 2011}}&lt;/ref&gt;&lt;ref&gt;{{cite web|title=Virtual floppy disk overview|url=http://www.microsoft.com/resources/documentation/WindowsServ/2003/all/ADS/en-us/nbs_vf_overview.mspx?mfr=true|work=ADS Administrator's Guide|publisher=Microsoft Corporation|accessdate=26 June 2011}}&lt;/ref&gt;&lt;ref name=&quot;mvs-2k5&quot; /&gt; Typically it contains an image of a 720 KB or 1.44 MB [[floppy disk]].&lt;ref name=&quot;mvs-2k5&quot;&gt;{{cite web|title=Creating virtual floppy disks in Virtual Server|url=http://technet.microsoft.com/en-us/library/cc708294%28v=WS.10%29.aspx|work=TechNet Library|publisher=Microsoft Corporation|accessdate=26 June 2011}}&lt;/ref&gt;&lt;ref&gt;{{cite web|last=Armstrong|first=Ben|title=Floppy disk image formats supported by Virtual PC and Virtual Server|
url=http://blogs.msdn.com/b/virtual_pc_guy/archive/2007/01/04/floppy-disk-image-formats-supported-by-virtual-pc-and-virtual-server.aspx
|work=Virtual PC Guy's Blog|publisher=Microsoft Corporation|accessdate=2011-07-03|date=2007-01-05}}&lt;/ref&gt; Windows Virtual PC for Windows 7 (version 6.1) no longer offers a user interface for manipulating virtual floppy disks; however, it still supports virtual floppy disks via [[scripting]].&lt;ref&gt;{{cite web|last=Armstrong|first=Ben|title=Using Floppy Disks with Windows Virtual PC|url=http://blogs.msdn.com/b/virtual_pc_guy/archive/2009/10/01/using-floppy-disks-with-windows-virtual-pc.aspx|work=Virtual PC Guy's Blog|publisher=Microsoft Corporation|accessdate=26 June 2011|date=1 October 2009}}&lt;/ref&gt;

==See also==
* [[VMDK]]
* [[qcow]]
* [[Virtual disk image]]

==References==
{{reflist}}

== External links ==
{{Disk images}}

[[Category:Disk images]]

[[cs:VHD soubor]]
[[de:Virtual-Hard-Disk-Format]]
[[ko:VHD (íì¼ í¬ë§·)]]
[[it:VHD (formato file)]]
[[ja:VHD (ãã¡ã¤ã« ãã©ã¼ããã)]]
[[pl:Virtual Hard Disk]]
[[pt:Virtual Hard Disk]]
[[ru:VHD (ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°)]]</rev></revisions></page></pages></query></api>
